<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Between</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #f1f1f1;
      overflow: hidden;
      touch-action: manipulation;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
                   "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    /* 起動文 */
    #startup-message {
      position: absolute;
      top: 47%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.45em;
      letter-spacing: 0.06em;
      color: #555;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.8s ease;
      white-space: nowrap;
    }

    #startup-message.show {
      opacity: 0.9;
    }

    canvas {
      display: block;
    }
  </style>
</head>
<body>

  <div id="startup-message">ここに、私はいる</div>
  <canvas id="canvas"></canvas>

  <script>
    /* ===== 起動文（完全初回のみ） ===== */
    (() => {
      const KEY = "between_first_launch";
      const msg = document.getElementById("startup-message");

      if (!localStorage.getItem(KEY)) {
        localStorage.setItem(KEY, "true");

        requestAnimationFrame(() => {
          msg.classList.add("show");
        });

        setTimeout(() => {
          msg.classList.remove("show");
        }, 3500);
      }
    })();

    /* ===== Canvas ===== */
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener("resize", resize);

    const dots = [];

    class Dot {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.baseRadius = random(6, 16);
        this.radius = 0;
        this.alpha = 0;
        this.life = 0;
      }

      update() {
        this.life += 0.02;
        this.radius = this.baseRadius * easeOut(this.life);
        this.alpha = Math.max(0, 0.6 - this.life * 0.3);
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(120,120,120,${this.alpha})`;
        ctx.fill();
      }
    }

    function random(min, max) {
      return Math.random() * (max - min) + min;
    }

    function easeOut(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    /* ===== タップ判定（スワイプ無視） ===== */
    let touchMoved = false;

    canvas.addEventListener("touchstart", () => {
      touchMoved = false;
    });

    canvas.addEventListener("touchmove", () => {
      touchMoved = true;
    });

    canvas.addEventListener("touchend", () => {
      if (!touchMoved) {
        dots.push(new Dot());
      }
    });

    canvas.addEventListener("click", () => {
      dots.push(new Dot());
    });

    /* ===== ループ ===== */
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = dots.length - 1; i >= 0; i--) {
        const d = dots[i];
        d.update();
        d.draw();
        if (d.alpha <= 0) dots.splice(i, 1);
      }

      requestAnimationFrame(animate);
    }
    animate();

    /*
      Akashic Record:
      ここに、私はいる
    */
  </script>

</body>
</html>
